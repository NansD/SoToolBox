import { Component } from "@angular/core";
import { NavController } from "ionic-angular";
import { WeatherProvider } from "../../providers/weather/weather";

@Component({
  selector: "page-home",
  templateUrl: "home.html"
})
export class HomePage {
  weather: any;
  weatherListProps: any;
  // TODO: refactor this
  location: {
    cityName: string;
    countryCode: string;
  };
  units: string;

  constructor(
    public navCtrl: NavController,
    private weatherProvider: WeatherProvider
  ) {}

  setFakeWeather() {
    this.weather = JSON.parse(
      '{"cod":"200","message":0.0402,"cnt":40,"list":[{"dt":1533578400,"main":{"temp":28.5,"temp_min":28.5,"temp_max":30.25,"pressure":1018.69,"sea_level":1025.7,"grnd_level":1018.69,"humidity":43,"temp_kf":-1.75},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":1.4,"deg":213.001},"sys":{"pod":"d"},"dt_txt":"2018-08-06 18:00:00"},{"dt":1533589200,"main":{"temp":20.94,"temp_min":20.94,"temp_max":22.26,"pressure":1018.92,"sea_level":1026,"grnd_level":1018.92,"humidity":46,"temp_kf":-1.31},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.64,"deg":270.003},"sys":{"pod":"n"},"dt_txt":"2018-08-06 21:00:00"},{"dt":1533600000,"main":{"temp":16.51,"temp_min":16.51,"temp_max":17.39,"pressure":1018.26,"sea_level":1025.34,"grnd_level":1018.26,"humidity":80,"temp_kf":-0.88},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":1.22,"deg":283.004},"sys":{"pod":"n"},"dt_txt":"2018-08-07 00:00:00"},{"dt":1533610800,"main":{"temp":14.72,"temp_min":14.72,"temp_max":15.15,"pressure":1017.13,"sea_level":1024.16,"grnd_level":1017.13,"humidity":81,"temp_kf":-0.44},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":1.16,"deg":165.001},"sys":{"pod":"n"},"dt_txt":"2018-08-07 03:00:00"},{"dt":1533621600,"main":{"temp":18.14,"temp_min":18.14,"temp_max":18.14,"pressure":1016.88,"sea_level":1023.92,"grnd_level":1016.88,"humidity":74,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":1.24,"deg":136.5},"sys":{"pod":"d"},"dt_txt":"2018-08-07 06:00:00"},{"dt":1533632400,"main":{"temp":29.1,"temp_min":29.1,"temp_max":29.1,"pressure":1016.07,"sea_level":1022.94,"grnd_level":1016.07,"humidity":46,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":3.41,"deg":151.501},"sys":{"pod":"d"},"dt_txt":"2018-08-07 09:00:00"},{"dt":1533643200,"main":{"temp":33.18,"temp_min":33.18,"temp_max":33.18,"pressure":1014.6,"sea_level":1021.43,"grnd_level":1014.6,"humidity":37,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":5.01,"deg":176.503},"sys":{"pod":"d"},"dt_txt":"2018-08-07 12:00:00"},{"dt":1533654000,"main":{"temp":31.91,"temp_min":31.91,"temp_max":31.91,"pressure":1013.49,"sea_level":1020.44,"grnd_level":1013.49,"humidity":43,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":88},"wind":{"speed":5.67,"deg":233.503},"rain":{"3h":0.19},"sys":{"pod":"d"},"dt_txt":"2018-08-07 15:00:00"},{"dt":1533664800,"main":{"temp":30.65,"temp_min":30.65,"temp_max":30.65,"pressure":1012.84,"sea_level":1020.04,"grnd_level":1012.84,"humidity":42,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":64},"wind":{"speed":1.45,"deg":231.003},"rain":{"3h":0.18},"sys":{"pod":"d"},"dt_txt":"2018-08-07 18:00:00"},{"dt":1533675600,"main":{"temp":24.58,"temp_min":24.58,"temp_max":24.58,"pressure":1013.28,"sea_level":1020.24,"grnd_level":1013.28,"humidity":57,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":68},"wind":{"speed":1.61,"deg":210.001},"rain":{},"sys":{"pod":"n"},"dt_txt":"2018-08-07 21:00:00"},{"dt":1533686400,"main":{"temp":20.17,"temp_min":20.17,"temp_max":20.17,"pressure":1013.86,"sea_level":1020.82,"grnd_level":1013.86,"humidity":67,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":20},"wind":{"speed":3.66,"deg":293.501},"rain":{"3h":0.04},"sys":{"pod":"n"},"dt_txt":"2018-08-08 00:00:00"},{"dt":1533697200,"main":{"temp":17.22,"temp_min":17.22,"temp_max":17.22,"pressure":1015.11,"sea_level":1022.14,"grnd_level":1015.11,"humidity":87,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":0},"wind":{"speed":2.8,"deg":258.501},"rain":{"3h":0.02},"sys":{"pod":"n"},"dt_txt":"2018-08-08 03:00:00"},{"dt":1533708000,"main":{"temp":17.66,"temp_min":17.66,"temp_max":17.66,"pressure":1016.32,"sea_level":1023.43,"grnd_level":1016.32,"humidity":88,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":5.07,"deg":232.502},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-08 06:00:00"},{"dt":1533718800,"main":{"temp":23.47,"temp_min":23.47,"temp_max":23.47,"pressure":1017.78,"sea_level":1024.94,"grnd_level":1017.78,"humidity":62,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":5.12,"deg":246.502},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-08 09:00:00"},{"dt":1533729600,"main":{"temp":26.01,"temp_min":26.01,"temp_max":26.01,"pressure":1018.62,"sea_level":1025.73,"grnd_level":1018.62,"humidity":51,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":5.71,"deg":253},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-08 12:00:00"},{"dt":1533740400,"main":{"temp":26.13,"temp_min":26.13,"temp_max":26.13,"pressure":1019.13,"sea_level":1026.15,"grnd_level":1019.13,"humidity":46,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":5.11,"deg":262.001},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-08 15:00:00"},{"dt":1533751200,"main":{"temp":24.42,"temp_min":24.42,"temp_max":24.42,"pressure":1019.48,"sea_level":1026.5,"grnd_level":1019.48,"humidity":43,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":3.76,"deg":269.503},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-08 18:00:00"},{"dt":1533762000,"main":{"temp":19.1,"temp_min":19.1,"temp_max":19.1,"pressure":1020.37,"sea_level":1027.42,"grnd_level":1020.37,"humidity":50,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":3.11,"deg":306.005},"rain":{},"sys":{"pod":"n"},"dt_txt":"2018-08-08 21:00:00"},{"dt":1533772800,"main":{"temp":16.03,"temp_min":16.03,"temp_max":16.03,"pressure":1020.14,"sea_level":1027.11,"grnd_level":1020.14,"humidity":63,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":3.01,"deg":343.507},"rain":{},"sys":{"pod":"n"},"dt_txt":"2018-08-09 00:00:00"},{"dt":1533783600,"main":{"temp":15.09,"temp_min":15.09,"temp_max":15.09,"pressure":1018.83,"sea_level":1026.05,"grnd_level":1018.83,"humidity":69,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02n"}],"clouds":{"all":24},"wind":{"speed":2.67,"deg":15.0026},"rain":{},"sys":{"pod":"n"},"dt_txt":"2018-08-09 03:00:00"},{"dt":1533794400,"main":{"temp":17.29,"temp_min":17.29,"temp_max":17.29,"pressure":1017.58,"sea_level":1024.54,"grnd_level":1017.58,"humidity":63,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":12},"wind":{"speed":4.31,"deg":42.5012},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-09 06:00:00"},{"dt":1533805200,"main":{"temp":23.78,"temp_min":23.78,"temp_max":23.78,"pressure":1015.06,"sea_level":1022.21,"grnd_level":1015.06,"humidity":66,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":92},"wind":{"speed":4.27,"deg":137.5},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-09 09:00:00"},{"dt":1533816000,"main":{"temp":25.82,"temp_min":25.82,"temp_max":25.82,"pressure":1013.14,"sea_level":1020.1,"grnd_level":1013.14,"humidity":68,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":76},"wind":{"speed":2.4,"deg":146.002},"rain":{"3h":0.29},"sys":{"pod":"d"},"dt_txt":"2018-08-09 12:00:00"},{"dt":1533826800,"main":{"temp":25.85,"temp_min":25.85,"temp_max":25.85,"pressure":1010.93,"sea_level":1017.92,"grnd_level":1010.93,"humidity":82,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10d"}],"clouds":{"all":44},"wind":{"speed":5.41,"deg":190},"rain":{"3h":3.45},"sys":{"pod":"d"},"dt_txt":"2018-08-09 15:00:00"},{"dt":1533837600,"main":{"temp":23.92,"temp_min":23.92,"temp_max":23.92,"pressure":1011.02,"sea_level":1018.33,"grnd_level":1011.02,"humidity":74,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":68},"wind":{"speed":7.07,"deg":186.503},"rain":{"3h":1.78},"sys":{"pod":"d"},"dt_txt":"2018-08-09 18:00:00"},{"dt":1533848400,"main":{"temp":18.63,"temp_min":18.63,"temp_max":18.63,"pressure":1011.93,"sea_level":1019.17,"grnd_level":1011.93,"humidity":99,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":5.12,"deg":219.504},"rain":{"3h":6.27},"sys":{"pod":"n"},"dt_txt":"2018-08-09 21:00:00"},{"dt":1533859200,"main":{"temp":13.97,"temp_min":13.97,"temp_max":13.97,"pressure":1016.72,"sea_level":1023.83,"grnd_level":1016.72,"humidity":99,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":88},"wind":{"speed":8.72,"deg":285.5},"rain":{"3h":1.02},"sys":{"pod":"n"},"dt_txt":"2018-08-10 00:00:00"},{"dt":1533870000,"main":{"temp":12.87,"temp_min":12.87,"temp_max":12.87,"pressure":1020.57,"sea_level":1027.72,"grnd_level":1020.57,"humidity":91,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":0},"wind":{"speed":5.37,"deg":260.002},"rain":{"3h":0.06},"sys":{"pod":"n"},"dt_txt":"2018-08-10 03:00:00"},{"dt":1533880800,"main":{"temp":14.53,"temp_min":14.53,"temp_max":14.53,"pressure":1022.74,"sea_level":1029.95,"grnd_level":1022.74,"humidity":91,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":20},"wind":{"speed":5.6,"deg":248.001},"rain":{"3h":0.0099999999999998},"sys":{"pod":"d"},"dt_txt":"2018-08-10 06:00:00"},{"dt":1533891600,"main":{"temp":17.42,"temp_min":17.42,"temp_max":17.42,"pressure":1024.76,"sea_level":1031.87,"grnd_level":1024.76,"humidity":81,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":32},"wind":{"speed":5.91,"deg":244.003},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-10 09:00:00"},{"dt":1533902400,"main":{"temp":18.31,"temp_min":18.31,"temp_max":18.31,"pressure":1026,"sea_level":1032.98,"grnd_level":1026,"humidity":73,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":64},"wind":{"speed":5.82,"deg":238},"rain":{},"sys":{"pod":"d"},"dt_txt":"2018-08-10 12:00:00"},{"dt":1533913200,"main":{"temp":16.65,"temp_min":16.65,"temp_max":16.65,"pressure":1026.05,"sea_level":1032.99,"grnd_level":1026.05,"humidity":80,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":56},"wind":{"speed":5.11,"deg":242},"rain":{"3h":0.32},"sys":{"pod":"d"},"dt_txt":"2018-08-10 15:00:00"},{"dt":1533924000,"main":{"temp":17.24,"temp_min":17.24,"temp_max":17.24,"pressure":1026.07,"sea_level":1033.12,"grnd_level":1026.07,"humidity":74,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":36},"wind":{"speed":4.96,"deg":237.502},"rain":{"3h":0.049999999999999},"sys":{"pod":"d"},"dt_txt":"2018-08-10 18:00:00"},{"dt":1533934800,"main":{"temp":13.58,"temp_min":13.58,"temp_max":13.58,"pressure":1026.31,"sea_level":1033.49,"grnd_level":1026.31,"humidity":86,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":0},"wind":{"speed":3.01,"deg":218.008},"rain":{"3h":0.0099999999999998},"sys":{"pod":"n"},"dt_txt":"2018-08-10 21:00:00"},{"dt":1533945600,"main":{"temp":11.79,"temp_min":11.79,"temp_max":11.79,"pressure":1026.21,"sea_level":1033.43,"grnd_level":1026.21,"humidity":93,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":4.17,"deg":199.501},"rain":{},"sys":{"pod":"n"},"dt_txt":"2018-08-11 00:00:00"},{"dt":1533956400,"main":{"temp":11.63,"temp_min":11.63,"temp_max":11.63,"pressure":1024.96,"sea_level":1032.13,"grnd_level":1024.96,"humidity":94,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":68},"wind":{"speed":5.47,"deg":199.501},"rain":{},"sys":{"pod":"n"},"dt_txt":"2018-08-11 03:00:00"},{"dt":1533967200,"main":{"temp":12.7,"temp_min":12.7,"temp_max":12.7,"pressure":1024.07,"sea_level":1031.28,"grnd_level":1024.07,"humidity":91,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":68},"wind":{"speed":7.25,"deg":204.002},"rain":{"3h":0.24},"sys":{"pod":"d"},"dt_txt":"2018-08-11 06:00:00"},{"dt":1533978000,"main":{"temp":15.06,"temp_min":15.06,"temp_max":15.06,"pressure":1023.83,"sea_level":1030.98,"grnd_level":1023.83,"humidity":89,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":80},"wind":{"speed":8.87,"deg":219.501},"rain":{"3h":0.92},"sys":{"pod":"d"},"dt_txt":"2018-08-11 09:00:00"},{"dt":1533988800,"main":{"temp":15.37,"temp_min":15.37,"temp_max":15.37,"pressure":1023.87,"sea_level":1030.92,"grnd_level":1023.87,"humidity":96,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":7.21,"deg":234.002},"rain":{"3h":4.2125},"sys":{"pod":"d"},"dt_txt":"2018-08-11 12:00:00"},{"dt":1533999600,"main":{"temp":15.69,"temp_min":15.69,"temp_max":15.69,"pressure":1024.29,"sea_level":1031.31,"grnd_level":1024.29,"humidity":100,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":5.21,"deg":262.001},"rain":{"3h":3.6375},"sys":{"pod":"d"},"dt_txt":"2018-08-11 15:00:00"}],"city":{"id":2998324,"name":"Lille","coord":{"lat":50.6305,"lon":3.0706},"country":"FR","population":228328}}'
    );
  }

  ionViewWillEnter() {
    this.location = {
      cityName: "Lille",
      countryCode: "fr"
    };
    this.units = "metric";
    this.setFakeWeather();
    this.processWeather();

  }

  processWeather() {
    let weather = this.weather;
    this.weather.list.map(item => {
      item.date = new Date(item.dt * 1000);
      item.dt = new Date(item.dt * 1000).getDate();
    });

    // TODO: move this to a helper class
    // helper function to group items by prop
    let groupBy = function(array, prop) {
      return array.reduce(function(groups, item) {
        let val = item[prop];
        groups[val] = groups[val] || [];
        groups[val].push(item);
        return groups;
      }, {});
    };
    this.weather.list = groupBy(this.weather.list, "dt");
    this.weatherListProps = Object.keys(this.weather.list);
  }

  getWeather(){
    console.log("getWeather");
    // this.weatherProvider.getWeather(this.location.cityName, this.location.countryCode).subscribe(weather =>{
    //   console.log(weather);
    // })
  }
}
